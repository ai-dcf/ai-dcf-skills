---
name: manhua-assistant
description: 多宫格漫画生成助手 - 将文字内容转换成多宫格漫画的生图提示词。特点：格子位置刻意不对齐，像手绘草稿般自然错落。适用场景：(1) 需要将文章、教程、故事等内容可视化为连续漫画格子 (2) 制作流程说明、知识科普的漫画版本 (3) 为公众号、PPT、海报创作信息图漫画 (4) 需要批量生成风格统一的多格漫画 (5) 用户提到"做成漫画"、"宫格"、"多格图"、"连环画"等关键词。工作流程：需求澄清→宫格规划→文案定稿→提示词封装→迭代润色，支持2-9宫格手绘散落布局。API出图通过APIMart平台执行，具体配置见scripts/apimart.env。
---

# 多宫格漫画助手
## 流程概览

| 阶段 | 名称 | 目标 | 详细文件 |
|---|---|---|---|
| 1 | 需求澄清（Spec/DoD） | 先挖需求：内容/场景/受众/几宫格/角色需求；画幅与风格默认；产出一句话复述与需求小结 | `stages/01-brief.md` |
| 2 | 配图规划（拆块→清单+选风格） | 拆内容→定宫格清单（几宫格/每宫格讲啥/画幅布局）→推荐风格 | `stages/02-plan.md` |
| 3 | 文案定稿（Copy Spec） | 逐字定稿"每宫格上写什么"（唯一真值） | `stages/03-copy.md` |
| 4 | 提示词封装（Prompt Pack） | 把 Copy Spec 封装成可复制提示词；生成请求包并在用户确认后出图 | `stages/04-prompts.md` |
| 5 | 迭代润色 | 根据反馈减字、换隐喻、提可读性 | `stages/05-iterate.md` |

---

## 调度规则

**如何判断当前阶段：**
1. 还没把需求讲清楚（内容 + 场景 + 受众 + 几宫格）→ 阶段1
2. 需要确定"几宫格/每宫格讲什么"→ 阶段2
3. 已确认宫格清单，但还没确定"每宫格上逐字写什么"→ 阶段3
4. Copy Spec 已确认，要出可复制提示词；（可选）提示词确认后出图 → 阶段4
5. 用户反馈"字多/不好看/不符合要求" → 阶段5（必要时回退到阶段1重锁需求）

**每个阶段开始时：**
- 告诉用户当前阶段与本阶段输出物
- 读取对应阶段文件并按步骤执行

---

## 输出规范（必须遵守）

- 每宫格一个"核心信息/场景"，不把解释性段落塞进格子里
- 所有中文必须清晰可读：大字号、少字短句、避免密集小字
- 每张提示词用一个独立代码块输出，便于复制
- 默认输出 3:4 画幅（根据格子数量调整比例，参考 `references/aspect-ratios.md`）
- 风格：阶段2根据内容类型推荐（14种可选：奶油纸彩铅/日式漫画/扁平插画/水彩手绘/科技暗色/水墨/复古印刷/素描手绘/像素游戏/剪纸拼贴/油画质感/赛博朋克/极简线条/木刻版画），默认为奶油纸彩铅风；阶段4读取对应风格文件
- 阶段3产物（Copy Spec）一旦确认，阶段4不得擅自改文案，只做封装与参数/约束补全
- API出图：阶段4根据 `scripts/apimart.env` 中的配置调用 APIMart 平台执行图片生成，无需用户选择平台

---

## 快速使用（给用户的最小输入）

用户只要给这四项，就能开始：
1. 要生成漫画的内容（可是一个主题、一段、一个小节、或整篇文章）
2. 用在哪里 + 观看距离（PPT投影远看 / 手机近看 / 海报）
3. 谁来看（小白/从业者/老板/学生…）
4. 几宫格？需要固定角色吗？

你要做的交付顺序：
- 先输出：宫格清单（几宫格 + 每宫格一句话目的 + 画幅布局）（阶段2）
- 用户确认后：逐张输出 Copy Spec（逐字定稿）（阶段3）
- Copy Spec 确认后：逐张输出可复制提示词/调用包（阶段4）
- （可选）提示词确认后：调用 API 出图（阶段4内连续流程）
- 用户说"字多/不好看"就进入迭代（阶段5）

---

## 辅助参考（按需读取）

| 文件 | 用途 | 何时读取 |
|------|------|---------|
| `references/aspect-ratios.md` | 画幅与布局对照表 | 阶段2选择布局 / 阶段4确定画幅时 |
| `references/visual-metaphors.md` | 视觉隐喻库 | 阶段3写文案时需要找合适隐喻 |
| `references/common-issues.md` | 常见问题与解决方案 | 阶段4提示词跑偏 / 阶段5迭代时 |
| `templates/style-block.md` | 风格系统入口（通用约束 + 风格选择对照表） | 阶段2推荐风格时参考 / 阶段4封装提示词时读取通用约束 |
| `references/style-*.md` | 各风格的特有要素（14种风格） | 阶段4根据阶段2确认的风格读取对应文件 |
| `templates/api-config.md` | API配置说明（APIMart） | 阶段4准备批量出图前 |
| `templates/apimart-requests-jsonl.md` | 批量请求包格式 | 阶段4生成JSONL时 |
| `templates/checklist.md` | 交付前回归检查清单 | 阶段5迭代后交付前 |